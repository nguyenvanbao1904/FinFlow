<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mainLayout}"
      lang="vn">

<head>
    <title layout:fragment="pageTitle">Quản lý Hạng mục Mặc định</title>
    <th:block layout:fragment="pageCss">
        <link rel="stylesheet" th:href="@{/css/adminStyle/categoryManagement.css}">
    </th:block>
</head>

<body>
<section id="category-management" class="content-section active" layout:fragment="content">
    <header class="content-header">
        <h1>Quản lý Hạng mục Mặc định</h1>
        <div>
            <button class="btn btn-primary" id="add-icon-btn">Thêm icon mới</button>
            <button class="btn btn-primary" id="add-category-btn">Thêm Hạng mục mới</button>
        </div>
    </header>
    
    <form th:action="@{/categories}">
        <div class="form-group">
            <input type="text" class="search-box" placeholder="Tìm kiếm" name="q" th:value="${param.q}">
        </div>
        <div class="form-group">
            <label>Loại hạng mục</label>
            <select name="type">
                <option value="expense" th:selected="${param.type == 'expense'}">Chi tiêu</option>
                <option value="income" th:selected="${param.type == 'income'}">Thu nhập</option>
                <option value="saving" th:selected="${param.type == 'saving'}">Tiết kiệm</option>
                <option value="all" th:selected="${param.type == 'all'}">Tất cả</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Tìm kiếm</button>
    </form>
    
    <div class="categories-grid">
        <!-- Hạng mục Chi tiêu -->
        <div class="category-column">
            <div class="column-header">
                <h2><i class="fa-solid fa-arrow-down expense-color"></i> Hạng mục Chi tiêu</h2>
                <span class="category-count" th:text="'Trang ' + ${expenseCurrentPage} + '/' + ${expenseTotalPages}"></span>
            </div>
            <ul class="category-list">
                <li class="category-item" th:each="category : ${categoriesExpense}">
                    <div class="category-icon" th:style="'background-color:' + ${category.colorCode}">
                        <i th:class="${category.icon.iconClass}"></i>
                    </div>
                    <span class="category-name" th:text="${category.name}"></span>
                    <div class="category-actions">
                        <button class="action-btn-sm edit">
                            <a th:href="@{/categories/{id}(id=${category.id})}">Sửa</a>
                        </button>
                        <button class="action-btn-sm delete" th:data-category-id="${category.id}">Xóa</button>
                    </div>
                </li>
            </ul>
            <!-- Pagination cho Chi tiêu -->
            <div class="pagination-container">
                <!-- Nút Trang trước -->
                <div class="pagination-controls" th:if="${expenseCurrentPage > 1 or expenseHasNext}">
                    <a th:if="${expenseCurrentPage > 1}"
                       th:href="@{/categories(expensePage=${expenseCurrentPage - 1}, incomePage=${incomeCurrentPage}, savingPage=${savingCurrentPage}, iconPage=${iconCurrentPage}, q=${param.q}, type=${param.type})}" 
                       class="btn btn-secondary pagination-btn prev-btn">
                        <i class="fa-solid fa-chevron-left"></i> Trang trước
                    </a>
                    
                    <!-- Hiển thị số trang -->
                    <span class="pagination-info" th:if="${expenseTotalPages > 1}">
                        Trang <span th:text="${expenseCurrentPage}">1</span> / <span th:text="${expenseTotalPages}">1</span>
                    </span>
                    
                    <!-- Nút Trang sau -->
                    <a th:if="${expenseHasNext}"
                       th:href="@{/categories(expensePage=${expenseCurrentPage + 1}, incomePage=${incomeCurrentPage}, savingPage=${savingCurrentPage}, iconPage=${iconCurrentPage}, q=${param.q}, type=${param.type})}" 
                       class="btn btn-secondary pagination-btn next-btn">
                        Trang sau <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hạng mục Thu nhập -->
        <div class="category-column">
            <div class="column-header">
                <h2><i class="fa-solid fa-arrow-up income-color"></i> Hạng mục Thu nhập</h2>
                <span class="category-count" th:text="'Trang ' + ${incomeCurrentPage} + '/' + ${incomeTotalPages}"></span>
            </div>
            <ul class="category-list">
                <li class="category-item" th:each="category : ${categoriesIncome}">
                    <div class="category-icon" th:style="'background-color:' + ${category.colorCode}">
                        <i th:class="${category.icon.iconClass}"></i>
                    </div>
                    <span class="category-name" th:text="${category.name}"></span>
                    <div class="category-actions">
                        <button class="action-btn-sm edit">
                            <a th:href="@{/categories/{id}(id=${category.id})}">Sửa</a>
                        </button>
                        <button class="action-btn-sm delete" th:data-category-id="${category.id}">Xóa</button>
                    </div>
                </li>
            </ul>
            <!-- Pagination cho Thu nhập -->
            <div class="pagination-container">
                <div class="pagination-controls" th:if="${incomeCurrentPage > 1 or incomeHasNext}">
                    <a th:if="${incomeCurrentPage > 1}"
                       th:href="@{/categories(expensePage=${expenseCurrentPage}, incomePage=${incomeCurrentPage - 1}, savingPage=${savingCurrentPage}, iconPage=${iconCurrentPage}, q=${param.q}, type=${param.type})}" 
                       class="btn btn-secondary pagination-btn prev-btn">
                        <i class="fa-solid fa-chevron-left"></i> Trang trước
                    </a>
                    
                    <span class="pagination-info" th:if="${incomeTotalPages > 1}">
                        Trang <span th:text="${incomeCurrentPage}">1</span> / <span th:text="${incomeTotalPages}">1</span>
                    </span>
                    
                    <a th:if="${incomeHasNext}"
                       th:href="@{/categories(expensePage=${expenseCurrentPage}, incomePage=${incomeCurrentPage + 1}, savingPage=${savingCurrentPage}, iconPage=${iconCurrentPage}, q=${param.q}, type=${param.type})}" 
                       class="btn btn-secondary pagination-btn next-btn">
                        Trang sau <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hạng mục Tiết kiệm -->
        <div class="category-column">
            <div class="column-header">
                <h2><i class="fa-solid fa-piggy-bank saving-color"></i> Hạng mục Tiết kiệm</h2>
                <span class="category-count" th:text="'Trang ' + ${savingCurrentPage} + '/' + ${savingTotalPages}"></span>
            </div>
            <ul class="category-list">
                <li class="category-item" th:each="category : ${categoriesSaving}">
                    <div class="category-icon" th:style="'background-color:' + ${category.colorCode}">
                        <i th:class="${category.icon.iconClass}"></i>
                    </div>
                    <span class="category-name" th:text="${category.name}"></span>
                    <div class="category-actions">
                        <button class="action-btn-sm edit">
                            <a th:href="@{/categories/{id}(id=${category.id})}">Sửa</a>
                        </button>
                        <button class="action-btn-sm delete" th:data-category-id="${category.id}">Xóa</button>
                    </div>
                </li>
            </ul>
            <!-- Pagination cho Tiết kiệm -->
            <div class="pagination-container">
                <div class="pagination-controls" th:if="${savingCurrentPage > 1 or savingHasNext}">
                    <a th:if="${savingCurrentPage > 1}"
                       th:href="@{/categories(expensePage=${expenseCurrentPage}, incomePage=${incomeCurrentPage}, savingPage=${savingCurrentPage - 1}, iconPage=${iconCurrentPage}, q=${param.q}, type=${param.type})}" 
                       class="btn btn-secondary pagination-btn prev-btn">
                        <i class="fa-solid fa-chevron-left"></i> Trang trước
                    </a>
                    
                    <span class="pagination-info" th:if="${savingTotalPages > 1}">
                        Trang <span th:text="${savingCurrentPage}">1</span> / <span th:text="${savingTotalPages}">1</span>
                    </span>
                    
                    <a th:if="${savingHasNext}"
                       th:href="@{/categories(expensePage=${expenseCurrentPage}, incomePage=${incomeCurrentPage}, savingPage=${savingCurrentPage + 1}, iconPage=${iconCurrentPage}, q=${param.q}, type=${param.type})}" 
                       class="btn btn-secondary pagination-btn next-btn">
                        Trang sau <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<th:block layout:fragment="extraContent">
    <!-- Category Modal -->
    <div id="category-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title">Thêm Hạng mục mới</h3>
            <form id="category-form" th:method="POST" th:action="@{/categories}" th:object="${categoryCreationRequest}">
                <div class="form-group">
                    <label for="category-name-input">Tên hạng mục</label>
                    <input type="text" id="category-name-input" placeholder="Ví dụ: Du lịch" required th:field="*{name}">
                </div>

                <div class="form-group">
                    <label>Loại hạng mục</label>
                    <select id="category-type-select" th:field="*{type}">
                        <option value="EXPENSE">Chi tiêu</option>
                        <option value="INCOME">Thu nhập</option>
                        <option value="SAVING">Tiết kiệm</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Chọn Icon</label>
                    <div class="icon-picker">
                        <div class="icon-option"
                             th:each="icon : ${icons}"
                             th:data-icon-id="${icon.id}"
                             th:title="${icon.name}">
                            <i th:class="${icon.iconClass}"></i>
                            <span th:text="${icon.name}"></span>
                            <i class="fa-solid fa-circle-xmark remove-icon"
                               th:data-icon-id="${icon.id}"></i>
                        </div>
                    </div>
                    <input type="hidden" id="category-icon-input" th:field="*{icon}" required>
                </div>

                <div class="form-group">
                    <label>Mã màu nền</label>
                    <input type="color" id="category-color-input"
                           name="colorCode"
                           th:value="${categoryCreationRequest.colorCode != null ? categoryCreationRequest.colorCode : '#7950f2'}"
                    >
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-category-btn">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu Hạng mục</button>
                </div>
            </form>
            <button class="close-btn" id="close-category-modal-btn">×</button>
        </div>
    </div>

    <div id="icon-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="icon-title">Thêm icon mới</h3>
            <form id="icon-form" th:method="POST" th:action="@{/icons}" th:object="${iconCreationRequest}">
                <div class="form-group">
                    <label for="icon-name-input">Tên icon</label>
                    <input type="text" id="icon-name-input" placeholder="Ví dụ: Du lịch" required th:field="*{name}">
                </div>

                <div class="form-group">
                    <label for="icon-class-input">Mã icon</label>
                    <input type="text" id="icon-class-input" placeholder="Ví dụ: fa-solid fa-house" required th:field="*{iconClass}" />
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-icon-btn">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu icon</button>
                </div>
            </form>
            <button class="close-btn" id="close-icon-modal-btn">×</button>
        </div>
    </div>
</th:block>

<th:block layout:fragment="pageJs">
    <script th:src="@{/js/categoryManagement.js}"></script>
</th:block>
</body>
</html>
